<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Codenames Board</title>
    <link rel="stylesheet" href="/static/style.css" />
    <style>
      #controls {
        margin-bottom: 15px;
      }
      #controls form, #controls button {
        display: inline-block;
        margin-right: 10px;
      }
      button {
        font-size: 14px;
        padding: 6px 12px;
        cursor: pointer;
      }

      table {
        margin-top: 15px;
        border-collapse: collapse;
      }

      td {
        border: 1px solid #ccc;
        padding: 10px;
        text-align: center;
        vertical-align: middle;
        width: 140px;
        height: 70px;
        position: relative;
        font-weight: bold;
        font-size: 16px;
        user-select: none;
      }

      small {
        font-size: 10px;
        color: darkgray;
      }

      /* Background colors for roles */
      .red-bg {
        background-color: crimson;
        color: white;
      }
      .blue-bg {
        background-color: navy;
        color: white;
      }
      .neutral-bg {
        background-color: #f0f0f0;
        color: black;
      }
      .assassin-bg {
        background-color: black;
        color: white;
      }
    </style>
</head>
<body>
    <h1>Codenames</h1>
    <p>
        First team: 
        <span class="{{ first_team }}">{{ first_team|capitalize }}</span> (has 9 words to find)
    </p>
    <p>
        Remaining words - 
        <span style="color: crimson; font-weight: bold;">Red: {{ red_remaining }}</span>,
        <span style="color: navy; font-weight: bold;">Blue: {{ blue_remaining }}</span>
    </p>

    <div id="controls">
      <form method="post" action="/reset" style="display:inline;" onsubmit="return confirmReset()">
          <button type="submit">Reset</button>
      </form>

      <form method="post" action="/toggle_map" style="display:inline;" onsubmit="return confirmShowMap()">
          <button type="submit">{{ "Hide Map" if map_visible else "Show Map" }}</button>
      </form>

      <form method="post" action="/set_language" style="display:inline; margin-left: 20px;">
        <label for="language-select">Main language:</label>
        <select name="language" id="language-select" onchange="this.form.submit()">
          <option value="english" {% if main_language == 'english' %}selected{% endif %}>English</option>
          <option value="greek" {% if main_language == 'greek' %}selected{% endif %}>Greek</option>
        </select>
      </form>
    </div>

    <table>
        {% for cell in board %}
            {% if loop.index0 % 5 == 0 %}
            <tr>
            {% endif %}
                <td class="
                    {% if cell.revealed and not map_visible %}{{cell.role}}-bg{% endif %}
                    {% if map_visible %}map-visible {{cell.role}}-bg{% endif %}
                  ">
                  {% if cell.revealed %}
                    <!-- Hide words by making text invisible but keep background color -->
                    <span style="visibility:hidden;">
                        {{cell.word_en}}<br />
                        <small>{{cell.word_gr}}</small>
                    </span>
                  {% else %}
                    {% if map_visible %}
                      <form method="post" action="/reveal">
                        <input type="hidden" name="idx" value="{{ loop.index0 }}" />
                        <button type="submit">
                          {% if main_language == 'english' %}
                            {{cell.word_en}}<br /><small>{{cell.word_gr}}</small>
                          {% else %}
                            {{cell.word_gr}}<br /><small>{{cell.word_en}}</small>
                          {% endif %}
                        </button>
                      </form>
                    {% else %}
                      <span>
                        {% if main_language == 'english' %}
                          {{cell.word_en}}<br /><small>{{cell.word_gr}}</small>
                        {% else %}
                          {{cell.word_gr}}<br /><small>{{cell.word_en}}</small>
                        {% endif %}
                      </span>
                    {% endif %}
                  {% endif %}
                </td>
            {% if loop.index0 % 5 == 4 %}
            </tr>
            {% endif %}
        {% endfor %}
    </table>

<script>
  function confirmReset() {
    return confirm("Are you sure you want to reset the game? This will start a new board.");
  }

  function confirmShowMap() {
    const mapVisible = {{ 'true' if map_visible else 'false' }};
    if (mapVisible) {
      return confirm("Hide the map and resume normal play?");
    } else {
      return confirm("Show the map? This reveals secret information.");
    }
  }
</script>
</body>
</html>
